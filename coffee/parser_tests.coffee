GAME_NO_HEADERS = "1. f1-f3 a5-c7 2. resign 0-1"

GAME0 = """
[Event "Tournament loa.mc.2013.jul.2.1"]
[Site "www.littlegolem.net"]
[White "Chaosu"]
[Black "Ivan Veselov"]
[Result "*"]
1. f1-f3 a5-c7 2. b1-d3 h7-e7 3. e8-g6 h6-f4 4. g8-g5 h2-d6 5. d1-g4 d6xg6 6. b8-b7 h5-f7 7. c8-f5 h3-h5 8. d3xg6 a6-c6 9. f8-g7 h4-f2 10. d8-d7 a2-c4 11. b7-b6 a3-c5 12. g5xc5 f4-d6 13. g1-g5 a4xd7 14. g7-f6 h5-h6 15. e1-e3 f7-d5 16. f6-e5 c6xf3 17. g6-e4 d7-d4 18. g5xe7 h6-e6 19. e7-f6 a7-b8 20. c1-d1 b8-c8 21. b6-b5 c8-d8 22. c5-a3 d8-d3 23. a3-b2 c7-c5 24. e3-d2 f2-g3 25. d2-e3 d6xd1 26. b2-c2 *
"""

GAME1 = """
[Event "Tournament loa.in.BLACKHOLE.14"]
[Site "www.littlegolem.net"]
[White "CalvinB"]
[Black "sembazuru"]
[Result "1-0"]
1. f1-h3 i3xg1 2. h1-h4 i2-g2 3. h9-h6 i4-g6 4. c1-c3 a3-c5 5. d1-d3 a2-b3 6. b1-f5 g1-g5 7. f9-h7 i6-h5 8. d9xg6 g2xg6 9. g9xg6 b3-c4 10. c9-f6 a4-d4 11. b9-e6 a6xd3 12. e1-e4 a8-c6 13. e4xc6 a7-d7 14. h3xd7 c4xe6 15. d7xd4 c5-d6 16. c6-d5 a5-c7 17. d5-e4 d3-e2 18. h7-e7 e2-f2 19. e9-f9 i7-f7 20. d4xd6 c7-d8 21. h4-f4 f2-h4 22. f9-e8 i5-g3 23. c3-e3 1-0
"""

GAME2 = """
[Event "Tournament null"]
[Site "www.littlegolem.net"]
[White "Héctor Máximo Canteros"]
[Black "karlhanf"]
[Result "1-0"]
1. b9-d7 a4xd7 2. h9-f7 a6-c8 3. c9-e7 a3-d6 4. e9-e6 a2-d5 5. d9-g6 a7-c5 6. f9-f6 c5-g5 7. g9xd6 a8-d8 8. e7-e4 d5-h5 9. h1-f3 a5-e5 10. g1-f2 i2xe6 11. b1-f5 i5xf2 12. f1-e2 resign 1-0
"""

GAME3 = """

[Event "Tournament loa.ch.23.1.1"]
[Site "www.littlegolem.net"]
[White "Ragnar Wikman"]
[Black "kingofthebesI"]
[Result "0-1"]
1. c1-c3 i6-g8 2. d9-b7 a8-d8 3. b9-b6 a2-d5 4. e1-b4 i5-f5 5. f1-d3 i8-e4 6. d1xd5 g8xd5 7. c3-c5 a3xd3 8. b1-b5 i3xg1 9. g9-d6 g1xc5 10. f9-f7 i2-g4 11. e9-b9 f5xf7 12. c9-c7 g4-e6 13. b9-d7 d3-f5 14. h9-g9 c5xc7 15. g9-f9 a7-b8 16. b7-d9 i7-e7 17. h1xe4 i4xe4 18. b4xe7 e4-c6 19. b5xb8 a6-b5 0-1
"""

TWO_GAMES = """
[Event "Tournament loa.ch.23.1.1"]
[Site "www.littlegolem.net"]
[White "kingofthebesI"]
[Black "emilioes"]
[Result "1-0"]
1. h1-h3 a6-c8 2. c1-c4 a7-c7 3. h9-e6 i6-g4 4. g1xg4 a8-d8 5. e1-e4 i8-f5 6. f1-d3 i3-f6 7. b1xf5 i5xf5 8. f9xf6 i4-g6 9. h3-h4 i2-g2 10. d1-d5 a5xd5 11. h4xd8 c8xc4 12. g4xc4 c7-e7 13. d9xd5 a2-a5 14. d3-b5 a5xd8 15. g9xg6 a3-b2 16. e9-f8 b2-d4 17. f8xd8 d4xf6 18. g6-f7 i7xf7 19. b5-d7 1-0

[Event "Tournament loa.ch.23.1.1"]
[Site "www.littlegolem.net"]
[White "Ragnar Wikman"]
[Black "kingofthebesI"]
[Result "0-1"]
1. c1-c3 i6-g8 2. d9-b7 a8-d8 3. b9-b6 a2-d5 4. e1-b4 i5-f5 5. f1-d3 i8-e4 6. d1xd5 g8xd5 7. c3-c5 a3xd3 8. b1-b5 i3xg1 9. g9-d6 g1xc5 10. f9-f7 i2-g4 11. e9-b9 f5xf7 12. c9-c7 g4-e6 13. b9-d7 d3-f5 14. h9-g9 c5xc7 15. g9-f9 a7-b8 16. b7-d9 i7-e7 17. h1xe4 i4xe4 18. b4xe7 e4-c6 19. b5xb8 a6-b5 0-1

"""

GAME_NO_MOVES = """
[Event "Tournament loa.ch.23.1.1"]
[Site "www.littlegolem.net"]
[White "kingofthebesI"]
[Black "emilioes"]
[Result "1-0"]
"""
valid = (pgn, expMoves, gameNo) ->
  games = PGN.parseGames(pgn)
  moves = _.map(games, (x) -> x.moves.length)
  deepEqual(moves, expMoves, gameNo)

invalid = (pgn, ident) ->
  throws((() -> PGN.parseGames(pgn)), ident)

numberOfCaptures = (pgn, exp) ->
  game = PGN.parseGame(pgn)
  cats = _(game.moves).countBy((x) -> if x.isCapture then 'capture' else 'normal')
  equal(cats.capture, exp, "Number of captures in GAME0")

test("PGN parsing", () ->
  valid("1. f1-f3 *", [1], "One move game")
  valid("1.f1-f3*", [1], "One move game without spaces")
  valid("1. f1-f3 1-0", [1], "One move game with result")
  valid(GAME_NO_HEADERS, [3], "GAME_NO_HEADERS")
  valid(GAME0, [51], "GAME0")
  valid(GAME1, [45], "GAME1")
  valid(GAME2, [24], "GAME2")
  valid(GAME3, [38], "GAME3")
  valid(TWO_GAMES, [37,38], "TWO_GAMES")
  invalid(GAME_NO_MOVES, "GAME_NO_MOVES")
  invalid("1. a0-c9", "Wrong coordinates")
  invalid("1. f1-f3", "No game result")
  invalid("", "Empty game")
  numberOfCaptures(GAME0, 7)
)

# game 0 - 7 captures
